"undefined"!=typeof OpenLayers&&null!==OpenLayers&&"undefined"!=typeof SOS&&null!==SOS&&"undefined"!=typeof jQuery&&null!==jQuery&&void 0!==jQuery.plot&&null!==jQuery.plot&&(OpenLayers.Lang.setCode("en"),OpenLayers.Util.extend(OpenLayers.Lang.en,{SOSObservedPropertyString:"Observed Property",SOSTimeString:"Time",SOSValueString:"Value"}),void 0===SOS.Ui&&(SOS.Ui=OpenLayers.Class({url:null,sos:null,offering:null,CLASS_NAME:"SOS.Ui",initialize:function(e){this.url=null,this.sos=null,this.offering=null,jQuery.extend(!0,this,e)},destroy:function(){},setSos:function(e){e instanceof SOS&&(this.sos=e)},getSos:function(){return this.haveValidSosObject()||SOS.Utils.isValidObject(this.url)&&(this.sos=new SOS({url:this.url})),this.sos},haveValidSosObject:function(){return SOS.Utils.isValidObject(this.sos)},getCapabilities:function(e){this.haveValidSosObject()||this.getSos(),this.haveValidSosObject()&&(this.sos.haveValidCapabilitiesObject()||(arguments.length>0&&this.sos.registerUserCallback({event:"sosCapsAvailable",scope:this,callback:e}),this.sos.getCapabilities()))},haveValidCapabilitiesObject:function(){return this.haveValidSosObject()&&this.sos.haveValidCapabilitiesObject()},setOffering:function(e){e instanceof SOS.Offering&&(this.offering=e)},getOffering:function(){return this.haveValidCapabilitiesObject()?this._getOffering():this.getCapabilities(this._getOffering),this.offering},_getOffering:function(){SOS.Utils.isValidObject(this.offeringId)&&(this.offering=this.sos.getOffering(this.offeringId))},haveValidOfferingObject:function(){return SOS.Utils.isValidObject(this.offering)},determineObservationQueryTimeParameters:function(){if(!SOS.Utils.isValidObject(this.startDatetime)||!SOS.Utils.isValidObject(this.endDatetime)){var e=this.relativeTime||"today",t=SOS.Utils.parseRelativeTime(e)
this.startDatetime=t.start.toISOString(),this.endDatetime=t.end.toISOString()}},constructDataTable:function(e){for(var t={label:"",headerLabel:"",name:"",uom:"",uomTitle:"",data:[]},i=0,s=e.getCountOfObservations();s>i;i++){var o=e.getObservationRecord(i)
t.name.length<1&&(t.name=o.observedPropertyTitle),t.uom.length<1&&(t.uom=o.result.uom,t.uomTitle=o.uomTitle),t.data.push([SOS.Utils.isoToJsTimestamp(o.time),o.result.value])}return e.name?t.label=e.name:e.id&&(t.label=e.id),t.label.length>0&&(t.label+=" "),t.label+=t.name,t.headerLabel=t.label+(t.uomTitle.length>0?" / "+t.uomTitle:""),t},subsetDataSeries:function(e,t,i){for(var s=[],o=0,n=0,a=e.length;a>n;n++){s[n]={label:"",headerLabel:"",name:"",uom:"",uomTitle:"",data:[]},o=0
for(var r in{label:"",headerLabel:"",name:"",uom:"",uomTitle:""})s[n][r]=e[n][r]
for(var l=0,c=e[n].data.length;c>l;l++)if(e[n].data[l][0]>=t&&e[n].data[l][0]<=i){s[n].data[o]=[]
for(var f=0,d=e[n].data[l].length;d>f;f++)s[n].data[o][f]=e[n].data[l][f]
o++}}return s},formatValueSimple:function(e,t,i){var s=parseFloat(e)
return Math.abs(s)<t&&0!=s?s.toExponential(i):s.toFixed(i)},formatValueFancy:function(e,t,i){var s=parseFloat(e)
return Math.abs(s)<t&&0!=s?(s=s.toExponential(i),s=s.replace(/e(.+)/,function(e,t){return" x 10 <sup>"+t+"</sup>"})):s=s.toFixed(i),s},displaySelectedIntervalStats:function(e,t){var i=t[0].item.series,s=Math.min(t[0].item.dataIndex,t[1].item.dataIndex),o=Math.max(t[0].item.dataIndex,t[1].item.dataIndex),n=i.data.slice(s,o+1),a=SOS.Utils.extractColumn(n,1),r=SOS.Utils.computeStats(a),l=SOS.Utils.computeHistogram(a),c=jQuery("<div/>")
this.addSelectedIntervalStatsContent(c,t,r,l),e.after(c)
var f=[{text:"Close",click:function(){jQuery(this).dialog().dialog("close")}}],d=c.dialog({position:["center","center"],buttons:f,title:i.label,width:540,zIndex:1010,stack:!1})
d.bind("dialogclose",function(){jQuery(this).remove(),jQuery(this).dialog().dialog("destroy")})},addSelectedIntervalStatsContent:function(e,t,i,s){var o=t[0].item.series,n=jQuery('<div id="sosSelectedIntervalStatsTable" class="sos-selected-interval-stats-table"/>'),a=jQuery('<div id="sosSelectedIntervalStatsPlot" class="sos-selected-interval-stats-plot" style="width: 300px; height: 150px;"/>'),r=this.config.format.value,l=""
for(var c in{min:0,max:0,mean:0,median:0,q1:0,q3:0,variance:0,sd:0})l+="<tr>",l+='<td class="sos-control-title">'+c+"</td>",l+="<td> = "+r.formatter(parseFloat(i[c]),r.sciLimit,r.digits)+"</td>",l+="</tr>"
var f="<table><tbody>"
f+=l,f+="</tbody></table>",n.append(f),e.append('<span class="sos-control-title">'+o.name+" / "+o.uomTitle+"</span>","<hr></hr>"),e.append(n,a),this.config.stats=this.config.stats||{},this.config.stats.series=[{data:s.data}],this.config.stats.options={grid:{borderWidth:1},series:{color:o.color,bars:{show:!0,barWidth:s.binWidth}}},this.config.stats.object=jQuery.plot(a,this.config.stats.series,this.config.stats.options)}})),void 0===SOS.Plot&&(SOS.Plot=OpenLayers.Class(SOS.Ui,{url:null,sos:null,offering:null,offeringId:null,observedProperty:null,startDatetime:null,endDatetime:null,relativeTime:null,config:null,CLASS_NAME:"SOS.Plot",initialize:function(e){this.url=null,this.sos=null,this.offering=null,this.offeringId=null,this.observedProperty=null,this.startDatetime=null,this.endDatetime=null,this.relativeTime="today",this.config={plot:{object:null,id:"sosPlot",series:[],options:{show:!0,xaxis:{mode:"time",axisLabel:"Time",panRange:!1},yaxis:{},xaxes:[],yaxes:[],haveCustomAxes:!1,selection:{mode:"x"},zoom:{interactive:!0},pan:{interactive:!0},grid:{borderWidth:1,hoverable:!0,clickable:!0},legend:{show:!0,backgroundOpacity:.5},series:{lines:{show:!0},points:{show:!1},bars:{show:!1}}}},overview:{object:null,id:"sosPlotOverview",series:[],options:{show:!1,xaxis:{ticks:[],mode:"time"},yaxis:{ticks:[],autoscaleMargin:.1},selection:{mode:"x"},grid:{borderWidth:1},legend:{show:!1},series:{lines:{show:!0,lineWidth:1},points:{show:!1},bars:{show:!1},shadowSize:0}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}},mode:{append:!1}},jQuery.extend(!0,this,e)},destroy:function(){},setPlotOptions:function(e){jQuery.extend(!0,this.config.plot.options,e)},setOverviewOptions:function(e){jQuery.extend(!0,this.config.overview.options,e)},setAxisLogarithmic:function(e,t){e=e||"yaxis",t=t||10,this.config.plot.options[e].transform=function(e){return 0!=e?Math.log(e)/Math.log(t):0},this.config.plot.options[e].inverseTransform=function(e){return Math.pow(t,e)},this.config.overview.options[e].transform=this.config.plot.options[e].transform,this.config.overview.options[e].inverseTransform=this.config.plot.options[e].inverseTransform},setAxisReverse:function(e){e=e||"yaxis",this.config.plot.options[e].transform=this.config.plot.options[e].inverseTransform=function(e){return-e},this.config.overview.options[e].transform=this.config.plot.options[e].transform,this.config.overview.options[e].inverseTransform=this.config.plot.options[e].inverseTransform},display:function(e){arguments.length>0&&jQuery.extend(!0,this,e),this.haveValidCapabilitiesObject()?this._display():this.getCapabilities(this._display)},add:function(e){arguments.length>0&&(this.additional=this.additional||[],this.additional.push(e))},_display:function(){if(this.sos.unregisterUserCallback({event:"sosCapsAvailable",scope:this,callback:this._display}),this._getOffering(),this.haveValidOfferingObject()){if(SOS.Utils.isValidObject(this.observedProperty))if(SOS.Utils.isArray(this.observedProperty)){this.config.mode.append=!0
var e=this.observedProperty[this.config.plot.series.length]
e&&this.offering.filterObservedProperties(e)}else this.offering.filterObservedProperties(this.observedProperty)
this.determineObservationQueryTimeParameters(),this.offering.registerUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData}),this.offering.getObservations(this.startDatetime,this.endDatetime)}},drawObservationData:function(){return this.offering.unregisterUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData}),this.storeObservationData(),SOS.Utils.isArray(this.observedProperty)&&this.config.plot.series.length<this.observedProperty.length?(this._display(),this.config.plot.series.length):(this.draw(),void 0)},storeObservationData:function(){var e=this.constructDataTable(this.offering)
this.config.mode.append?this.config.plot.series.push(e):this.config.plot.series=[e]},draw:function(){this.resetBehaviour(),this.applyDefaults(),this.config.plot.options.show&&(this.config.plot.object=jQuery.plot(jQuery("#"+this.config.plot.id),this.config.plot.series,this.config.plot.options),this.config.overview.options.show&&this.drawOverview(),this.setupBehaviour(),this.config.overview.options.show&&this.setupOverviewBehaviour()),SOS.Utils.isValidObject(this.additional)&&this.addData()},applyDefaults:function(){var e=this.config.plot.options,t=this.config.plot.series
if(t.length>0&&jQuery.extend(!0,t[t.length-1],e.series),e.grid=e.grid||{},e.grid.show===!1)e.xaxis.axisLabel=null,e.yaxis.axisLabel=null
else if(!e.haveCustomAxes){e.yaxes=e.yaxes||[]
for(var i=0,s=t.length;s>i;i++)e.yaxes[i]={},t[i].yaxis=i+1,e.yaxes[i].axisLabel=t[i].name,e.yaxes[i].axisLabel+=t[i].uomTitle.length>0?" / "+t[i].uomTitle:""}},drawOverview:function(){var e=jQuery("#"+this.config.overview.id)
if(e.length<1){var t=jQuery("#"+this.config.plot.id)
e=jQuery('<div id="'+this.config.overview.id+'" class="sos-plot-overview"/>'),t.after(e)}this.config.overview.series=this.config.plot.series,this.config.overview.object=jQuery.plot(e,this.config.overview.series,this.config.overview.options)},setupBehaviour:function(){var e=jQuery("#"+this.config.plot.id),t=jQuery("#"+this.config.plot.id+"ValueBox")
t.length<1&&(t=jQuery('<div id="#'+this.config.plot.id+'ValueBox" class="sos-plot-valuebox" style="display:none"/>'),jQuery("body").after(t)),e.bind("plothover",{self:this},function(e,i,s){if(s){var o=e.data.self.config.format.time,n=e.data.self.config.format.value,a=i.pageX+20,r=i.pageY+20,l=s.datapoint[0],c=s.datapoint[1],f=jQuery('<p><span class="sos-control-title">Time:</span> <span>'+o.formatter(l)+'</span><br/><span class="sos-control-title">Value:</span> <span>'+n.formatter(c,n.sciLimit,n.digits)+" "+s.series.uomTitle+"</span></p>")
t.html(f),t.css({position:"absolute",left:a+"px",top:r+"px",borderColor:s.series.color}),t.show()}}),e.bind("mouseout",function(){t.hide()}),e.bind("plotclick",{self:this},function(t,i,s){var o=t.data.self
s&&(o.config.plot.selected=o.config.plot.selected||[],o.config.plot.object.highlight(s.series,s.datapoint),o.config.plot.selected.push({pos:i,item:s}),1==o.config.plot.selected.length&&o.greyOutSeries(s.seriesIndex),o.config.plot.selected.length>1&&(o.config.plot.selected[1].item.seriesIndex==o.config.plot.selected[0].item.seriesIndex&&o.displaySelectedIntervalStats(e,o.config.plot.selected),o.config.plot.object.unhighlight(),delete o.config.plot.selected,o.update()))})},setupOverviewBehaviour:function(){var e=jQuery("#"+this.config.plot.id),t=jQuery("#"+this.config.overview.id),i=this.config.plot,s=this.config.overview
e.bind("plotselected",{self:this},function(e,t){var o=e.data.self,n=i.object.getOptions()
jQuery.extend(n.xaxes[0],{min:t.xaxis.from,max:t.xaxis.to}),o.update(),i.object.clearSelection(t),s.object.setSelection(t,!0)}),t.bind("plotselected",{self:this},function(e,t){i.object.setSelection(t)}),t.bind("plotunselected",{self:this},function(e){var t=e.data.self,s=i.object.getOptions()
jQuery.extend(s.xaxes[0],{min:null,max:null}),t.update()})},resetBehaviour:function(){var e=jQuery("#"+this.config.plot.id),t=jQuery("#"+this.config.overview.id)
e.length>0&&e.unbind(),t.length>0&&t.unbind()},addData:function(){if(SOS.Utils.isValidObject(this.additional))for(var e=0,t=this.additional.length;t>e;e++)jQuery.extend(!0,this,this.additional[e]),this._getOffering(),this.haveValidOfferingObject()&&(SOS.Utils.isValidObject(this.observedProperty)&&this.offering.filterObservedProperties(this.observedProperty),this.determineObservationQueryTimeParameters(),this.offering.registerUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawAdditionalData}),this.offering.getObservations(this.startDatetime,this.endDatetime))},drawAdditionalData:function(){this.offering.unregisterUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawAdditionalData})
var e=this.constructDataTable(this.offering)
this.config.plot.series.push(e),this.config.plot.options.show&&(this.update(),this.config.overview.options.show&&(this.config.overview.series=this.config.plot.series,this.updateOverview()))},update:function(){this.config.plot.object.setData(this.config.plot.series),this.config.plot.object.setupGrid(),this.config.plot.object.draw()},updateOverview:function(){this.config.overview.object.setData(this.config.overview.series),this.config.overview.object.setupGrid(),this.config.overview.object.draw()},reset:function(){this.resetSeries(),this.resetOverviewSeries(),this.resetBehaviour()},greyOutSeries:function(e){for(var t=this.config.plot.object.getData(),i=0,s=t.length;s>i;i++)i!=e&&(t[i].color="rgb(240, 240, 240)")
this.config.plot.object.setupGrid(),this.config.plot.object.draw()},resetSeries:function(){this.config.plot.series=[]},resetOverviewSeries:function(){this.config.overview.series=[]},resetAxesLabels:function(){this.config.plot.options.xaxes=[],this.config.plot.options.yaxes=[]}})),void 0===SOS.Table&&(SOS.Table=OpenLayers.Class(SOS.Ui,{url:null,sos:null,offering:null,offeringId:null,observedProperty:null,startDatetime:null,endDatetime:null,relativeTime:null,config:null,CLASS_NAME:"SOS.Table",initialize:function(e){this.url=null,this.sos=null,this.offering=null,this.offeringId=null,this.observedProperty=null,this.startDatetime=null,this.endDatetime=null,this.relativeTime="today",this.config={table:{object:null,id:"sosTable",series:[],options:{show:!0,header:{},columns:{names:["Time","Value"]},scrollable:!1}},overview:{object:null,id:"sosTableOverview",series:[],options:{show:!1,xaxis:{ticks:[],mode:"time"},yaxis:{ticks:[],autoscaleMargin:.1},selection:{mode:"x"},grid:{borderWidth:1},legend:{show:!1},series:{lines:{show:!0,lineWidth:1},points:{show:!1},bars:{show:!1},shadowSize:0}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}},mode:{append:!1}},jQuery.extend(!0,this,e)},destroy:function(){},setTableOptions:function(e){jQuery.extend(!0,this.config.table.options,e)},setOverviewOptions:function(e){jQuery.extend(!0,this.config.overview.options,e)},display:function(e){arguments.length>0&&jQuery.extend(!0,this,e),this.haveValidCapabilitiesObject()?this._display():this.getCapabilities(this._display)},add:function(e){arguments.length>0&&(this.additional=this.additional||[],this.additional.push(e))},_display:function(){if(this.sos.unregisterUserCallback({event:"sosCapsAvailable",scope:this,callback:this._display}),this._getOffering(),this.haveValidOfferingObject()){if(SOS.Utils.isValidObject(this.observedProperty))if(SOS.Utils.isArray(this.observedProperty)){this.config.mode.append=!0
var e=this.observedProperty[this.config.table.series.length]
e&&this.offering.filterObservedProperties(e)}else this.offering.filterObservedProperties(this.observedProperty)
this.determineObservationQueryTimeParameters(),this.offering.registerUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData}),this.offering.getObservations(this.startDatetime,this.endDatetime)}},drawObservationData:function(){return this.offering.unregisterUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData}),this.storeObservationData(),SOS.Utils.isArray(this.observedProperty)&&this.config.table.series.length<this.observedProperty.length?(this._display(),this.config.table.series.length):(this.draw(),void 0)},storeObservationData:function(){var e=this.constructDataTable(this.offering)
this.config.mode.append?this.config.table.series.push(e):this.config.table.series=[e]},draw:function(){if(this.resetBehaviour(),this.applyDefaults(),this.config.table.options.show){var e=jQuery("#"+this.config.table.id)
this.clearTable(e),this.config.table.object=this.generateTable(e,this.config.table.series,this.config.table.options),this.config.overview.options.show&&this.drawOverview(),this.setupBehaviour(),this.config.overview.options.show&&this.setupOverviewBehaviour()}SOS.Utils.isValidObject(this.additional)&&this.addData()},applyDefaults:function(){var e=this.config.overview.options,t=this.config.table.series
t.length>0&&jQuery.extend(!0,t[t.length-1],e.series),e.yaxes=e.yaxes||[]
for(var i=0,s=t.length;s>i;i++)e.yaxes[i]={},t[i].yaxis=i+1},drawOverview:function(){var e=jQuery("#"+this.config.overview.id)
if(e.length<1){var t=jQuery("#"+this.config.table.id)
e=jQuery('<div id="'+this.config.overview.id+'" class="sos-plot-overview"/>'),t.after(e)}this.config.overview.series=this.config.table.series,this.config.overview.object=jQuery.plot(e,this.config.overview.series,this.config.overview.options)},setupBehaviour:function(){var e=jQuery("#"+this.config.table.id)
this.setupTableEventTriggers(e,"td"),e.delegate("td","mouseover mouseout",{self:this},function(e){e.data.self.config.table.selecting?e.data.self.highlightCellGroup(this):e.data.self.toggleHighlightCellGroup(this)}),e.bind("tableclick",{self:this},function(t){var i=t.data.self,s=i.eventToItem(t)
delete i.config.table.selecting,s&&(i.config.table.selected=i.config.table.selected||[],i.highlightSelectedCellGroup(t.target),i.config.table.selected.push({item:s}),1==i.config.table.selected.length&&i.greyOutSeries(s.seriesIndex),i.config.table.selected.length>1&&(i.config.table.selected[1].item.seriesIndex==i.config.table.selected[0].item.seriesIndex&&i.displaySelectedIntervalStats(e,i.config.table.selected),i.unhighlightSelected(),delete i.config.table.selected,i.update()))})},setupOverviewBehaviour:function(){var e=jQuery("#"+this.config.table.id),t=jQuery("#"+this.config.overview.id),i=this.config.overview
t.bind("plotselected",{self:this},function(e,t){e.data.self.subset(t.xaxis.from,t.xaxis.to),i.object.setSelection(t,!0)}),e.delegate("td","tableselecting",{self:this},function(e){e.data.self.config.table.selecting=!0,e.data.self.highlightSelectedCellGroup(e.target)}),e.delegate("td","tableshiftclickselecting",{self:this},function(e){e.data.self.highlightSelectedCellGroup(e.target)}),e.delegate("td","tableselected",{self:this},function(e,t){var s=e.data.self
if(delete s.config.table.selecting,t){var o=s.selectionToRanges(t)
t.items.length>1&&(s.subset(o.xaxis.from,o.xaxis.to),i.object.setSelection(o,!0),s.clearSelectionHighlighting())}}),t.bind("plotunselected",{self:this},function(e){e.data.self.update()})},setupTableEventTriggers:function(e,t){var i={active:!1,start:null,end:null}
e.delegate(t,"mousedown mouseup click",{self:this},function(e){var t=e.data.self,s=jQuery(e.target)
if("mousedown"!=e.type||e.shiftKey||(i.active=!0,i.start=e,e.preventDefault(),s.trigger("tableselecting")),"mouseup"==e.type&&!e.shiftKey)if(i.active=!1,i.end=e,i.start.target==i.end.target)s.trigger("tableclick")
else{var o=[]
o.push({item:t.eventToItem(i.start)}),o.push({item:t.eventToItem(i.end)}),o[1].item.dataIndex<o[0].item.dataIndex&&o.reverse(),s.trigger("tableselected",{items:o})}if("click"==e.type&&e.shiftKey)if(i.active){i.active=!1,i.end=e
var o=[]
o.push({item:t.eventToItem(i.start)}),o.push({item:t.eventToItem(i.end)}),o[1].item.dataIndex<o[0].item.dataIndex&&o.reverse(),s.trigger("tableselected",{items:o})}else i.active=!0,i.start=e,e.preventDefault(),s.trigger("tableshiftclickselecting")
return!1})},resetBehaviour:function(){var e=jQuery("#"+this.config.table.id),t=jQuery("#"+this.config.overview.id)
e.length>0&&e.unbind(),t.length>0&&t.unbind()},addData:function(){if(SOS.Utils.isValidObject(this.additional))for(var e=0,t=this.additional.length;t>e;e++)jQuery.extend(!0,this,this.additional[e]),this._getOffering(),this.haveValidOfferingObject()&&(SOS.Utils.isValidObject(this.observedProperty)&&this.offering.filterObservedProperties(this.observedProperty),this.determineObservationQueryTimeParameters(),this.offering.registerUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawAdditionalData}),this.offering.getObservations(this.startDatetime,this.endDatetime))},drawAdditionalData:function(){this.offering.unregisterUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawAdditionalData})
var e=this.constructDataTable(this.offering)
this.config.table.series.push(e),this.config.table.options.show&&(this.update(),this.config.overview.options.show&&(this.config.overview.series=this.config.table.series,this.updateOverview()))},update:function(){this.config.table.object.html(""),this.generateTable(this.config.table.object,this.config.table.series,this.config.table.options)},updateOverview:function(){this.config.overview.object.setData(this.config.overview.series),this.config.overview.object.setupGrid(),this.config.overview.object.draw()},reset:function(){this.resetSeries(),this.resetOverviewSeries(),this.resetBehaviour()},greyOutSeries:function(e){for(var t=this.config.table.series,i={color:"rgb(240, 240, 240)"},s=0,o=t.length;o>s;s++)s!=e&&(jQuery('th[class^="sos-table"][id="sl'+s+'"]').css(i),jQuery('th[class^="sos-table"][id="ch'+s+'"]').css(i),jQuery('td[class^="sos-table"][id^="'+s+'"]').css(i),jQuery('td[class^="sos-table"][id^="'+s+'"]').removeClass("sos-table-highlight-selected"))},resetSeries:function(){this.config.table.series=[]},resetOverviewSeries:function(){this.config.overview.series=[]},resetHeaderLabels:function(){var e=this.config.table.series||[]
SOS.Utils.isValidObject(this.config.table.options.header.title)&&(this.config.table.options.header.title=null)
for(var t=0,i=e.length;i>t;t++)e[t].headerLabel=null},subset:function(e,t){var i=this.subsetDataSeries(this.config.table.series,e,t)
i&&(this.config.table.object.html(""),this.generateTable(jQuery("#"+this.config.table.id),i,this.config.table.options))},clearTable:function(e){e.html("")},generateTable:function(e,t,i){var s="",o=[],n=this.config.format.time,a=this.config.format.value
i.columns.names=i.columns.names||["Time","Value"]
for(var r=i.columns.names.length,l=0,c=t.length;c>l;l++)o.push(t[l].data.length)
var f=Math.max.apply(null,o)
s+='<thead class="sos-table">',s+='<tr class="sos-table">'
for(var l=0,c=t.length;c>l;l++)s+='<th id="sl'+l+'" class="sos-table" colspan="'+r+'">'+t[l].headerLabel+"</th>"
s+="</tr>",s+='<tr class="sos-table">'
for(var l=0,d=t.length;d>l;l++)for(var h=0,r=i.columns.names.length;r>h;h++)s+='<th id="ch'+l+'" class="sos-table">'+i.columns.names[h]+"</th>"
s+="</tr>",s+="</thead>",s+='<tfoot class="sos-table"/>',s+='<tbody class="sos-table">'
for(var l=0;f>l;l++){var p=l%2==0?"sos-table-even":"sos-table-odd"
s+='<tr class="'+p+'">'
for(var h=0,d=t.length;d>h;h++)if(SOS.Utils.isValidObject(t[h].data[l]))for(var u=0,g=t[h].data[l].length;g>u;u++){var b,v=h+"."+l+"."+u
b=0==u?n.formatter(t[h].data[l][u]):SOS.Utils.isNumber(t[h].data[l][u])?a.formatter(parseFloat(t[h].data[l][u]),a.sciLimit,a.digits):t[h].data[l][u],s+='<td class="sos-table" id="'+v+'">'+b+"</td>"}else s+="<td></td><td></td>"
s+="</tr>"}s+="</tbody>"
var m='<table class="sos-table">'
m+=SOS.Utils.isValidObject(i.header.title)?'<caption class="sos-table">'+i.header.title+"</caption>":"",m+=s,m+="</table>"
var O=jQuery(m)
return i.scrollable&&O.addClass("sos-table-scrollable"),e.append(O),e},generatePlainDataTable:function(e,t,i){var s="",o=[],n=this.config.format.time,a=this.config.format.value,r=i.commentCharacter||"#",l=i.columnSeparator||",",c=i.rowSeparator||"\n"
i.columns.names=i.columns.names||["Time","Value"],a.formatter=SOS.Ui.prototype.formatValueSimple
for(var f=0,d=t.length;d>f;f++)o.push(t[f].data.length)
var h=Math.max.apply(null,o)
s+=r
for(var f=0,d=t.length;d>f;f++)s+=t[f].label+(t[f].uom.length>0?" / "+t[f].uom:""),d-1>f&&(s+=l)
s+=c,s+=r
for(var f=0,p=t.length;p>f;f++)for(var u=0,g=i.columns.names.length;g>u;u++)s+=i.columns.names[u],(p-1>f||g-1>u)&&(s+=l)
s+=c
for(var f=0;h>f;f++){for(var u=0,p=t.length;p>u;u++){if(SOS.Utils.isValidObject(t[u].data[f]))for(var b=0,v=t[u].data[f].length;v>b;b++){var m
m=0==b?n.formatter(t[u].data[f][b]):SOS.Utils.isNumber(t[u].data[f][b])?a.formatter(parseFloat(t[u].data[f][b]),a.sciLimit,a.digits):t[u].data[f][b],s+=m,v-1>b&&(s+=l)}else s+=l
p-1>u&&(s+=l)}s+=c}var O=""
return O+=SOS.Utils.isValidObject(i.header.title)?i.header.title:"",O+=s,e=e||{},e.tableText=O,e},eventToItem:function(e){var t
if(e.target){var i=e.target.id.split(".")
i.length>=2&&(t={datapoint:[],dataIndex:0,series:{},seriesIndex:0,pageX:0,pageY:0},t.seriesIndex=parseInt(i[0],10),t.dataIndex=parseInt(i[1],10),SOS.Utils.isValidObject(this.config.table.series)&&(t.series=this.config.table.series[t.seriesIndex],t.datapoint=t.series.data[t.dataIndex]),t.pageX=e.pageX,t.pageY=e.pageY)}return t},selectionToRanges:function(e){var t
if(e&&e.items&&e.items.length>1){var i=e.items[0].item.datapoint[0],s=e.items[1].item.datapoint[0]
t={xaxis:{from:i,to:s}}}return t},highlight:function(e){jQuery(e).addClass("sos-table-highlight")},toggleHighlight:function(e){jQuery(e).toggleClass("sos-table-highlight")},unhighlight:function(){SOS.Utils.isValidObject(this.config.table.object)&&this.config.table.object.find("td").removeClass("sos-table-highlight")},highlightCellGroup:function(e){var t=jQuery(e)
this.highlight(t.closest("td").parent()[0].children)},toggleHighlightCellGroup:function(e){var t=jQuery(e)
this.toggleHighlight(t.closest("td").parent()[0].children)},highlightSelected:function(e){jQuery(e).addClass("sos-table-highlight-selected")},unhighlightSelected:function(){SOS.Utils.isValidObject(this.config.table.object)&&this.config.table.object.find("td").removeClass("sos-table-highlight-selected")},highlightSelectedCellGroup:function(e){var t=jQuery(e)
this.highlightSelected(t.closest("td").parent()[0].children)},clearSelectionHighlighting:function(){this.unhighlightSelected(),this.unhighlight()}})),void 0===SOS.Map&&(SOS.Map=OpenLayers.Class(SOS.Ui,{url:null,sos:null,config:null,CLASS_NAME:"SOS.Map",initialize:function(e){this.url=null,this.sos=null,this.config={map:{object:null,id:"sosMap",options:{defaultProjection:new OpenLayers.Projection("EPSG:4326"),centre:new OpenLayers.LonLat(0,0),params:{projection:"EPSG:4326",displayProjection:new OpenLayers.Projection("EPSG:4326")}}},overview:{options:{show:!1,params:{}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}},baseLayer:{object:null,id:"sosMapBaseLayer",options:{label:"OpenLayers WMS",url:"http://vmap0.tiles.osgeo.org/wms/vmap0?",params:{layers:"basic"},extras:{}}},featureOfInterestLayer:{object:null,id:"sosMapFeatureOfInterestLayer",options:{label:"Feature Of Interest",pointStyle:new OpenLayers.Style({pointRadius:5,fillColor:"#F80000",strokeWidth:1,label:"${name}",fontSize:"12px",fontFamily:"Courier New, monospace",fontWeight:"bold",labelAlign:"rb",labelXOffset:-10,labelOutlineColor:"white",labelOutlineWidth:3}),displayLatestObservations:!1}},latestObservationsPopup:{active:!0,caption:"Latest Values",columnHeadings:["Observed Property","Time","Value"]}},jQuery.extend(!0,this,e)},destroy:function(){},setMapOptions:function(e){jQuery.extend(!0,this.config.map.options,e)},setOverviewOptions:function(e){jQuery.extend(!0,this.config.overview.options,e)},setBaseLayerOptions:function(e){jQuery.extend(!0,this.config.baseLayer.options,e)},setFeatureOfInterestLayerOptions:function(e){jQuery.extend(!0,this.config.featureOfInterestLayer.options,e)},display:function(e){arguments.length>0&&jQuery.extend(!0,this,e),this.haveValidCapabilitiesObject()?this._display():this.getCapabilities(this._display)},_display:function(){this.config.isInitLoad=!0,this.initMap(),this.initOverviewMap(),this.initBaseLayer(),this.initView(),this.initFeatureOfInterestLayer(),this.config.isInitLoad=!1},initMap:function(){var e=jQuery("#"+this.config.map.id)
e.length<1&&(e=jQuery('<div id="'+this.config.map.id+'" class="sos-map"/>'),jQuery("body").append(e))
var t=new OpenLayers.Map(this.config.map.id,this.config.map.options.params)
t.addControl(new OpenLayers.Control.LayerSwitcher),t.addControl(new OpenLayers.Control.MousePosition),this.config.map.object=t},initOverviewMap:function(){var e=this.config.map.object
if(this.config.overview.options.show){var t=this.config.overview.options.params||{}
e.addControl(new OpenLayers.Control.OverviewMap(t))}},initBaseLayer:function(){var e=this.config.map.object,t=new OpenLayers.Layer.WMS(this.config.baseLayer.options.label,this.config.baseLayer.options.url,this.config.baseLayer.options.params,this.config.baseLayer.options.extras)
e.addLayers([t]),this.config.baseLayer.object=t},initView:function(){var e=this.config.map.object,t=this.config.map.options.centre||new OpenLayers.LonLat(0,0)
e.setCenter(t),e.zoomToMaxExtent()},initFeatureOfInterestLayer:function(){var e=new OpenLayers.StyleMap(this.config.featureOfInterestLayer.options.pointStyle),t=new OpenLayers.Layer.Vector(this.config.featureOfInterestLayer.options.label,{strategies:[new OpenLayers.Strategy.Fixed],protocol:new OpenLayers.Protocol.SOS({formatOptions:{internalProjection:this.config.map.object.getProjectionObject(),externalProjection:this.config.map.options.defaultProjection},url:this.url,fois:this.sos.getFeatureOfInterestIds()}),styleMap:e})
this.config.map.object.addLayer(t)
var i=new OpenLayers.Control.SelectFeature(t,{scope:this,onSelect:this.featureOfInterestSelectHandler})
this.config.map.object.addControl(i),i.activate(),this.config.featureOfInterestLayer.object=t},featureOfInterestSelectHandler:function(e){var t={foi:{id:e.attributes.id,name:e.attributes.name,geometry:e.geometry}}
this.config.map.selected=[],this.config.map.selected.push({item:t}),this.config.featureOfInterestLayer.options.displayLatestObservations&&(this.sos.registerUserCallback({event:"sosLatestObsAvailable",scope:this,callback:this.displayLatestObservations}),this.sos.getLatestObservationsForFeatureOfInterestId(t.foi.id)),this.sos.events.triggerEvent("sosMapFeatureOfInterestSelect")},displayLatestObservations:function(){var e=this.config.map.object
if(SOS.Utils.isValidObject(this.config.map.selected)){for(var t=this.config.map.selected[0].item.foi,i=0,s=e.popups.length;s>i;i++)e.removePopup(e.popups[i])
var o=new OpenLayers.Popup.FramedCloud("sosLatestObservations",t.geometry.getBounds().getCenterLonLat(),null,this.populateMultivariateTable(this.sos),null,!0,function(e){this.hide(),OpenLayers.Event.stop(e),this.map.getControlsByClass("OpenLayers.Control.SelectFeature")[0].unselectAll()})
e.addPopup(o)}},populateMultivariateTable:function(e){var t="",i="",s=this.config.format.time,o=this.config.format.value
if(SOS.Utils.isValidObject(e)){for(var n=0,a=e.getCountOfObservations();a>n;n++){var r=e.getObservationRecord(n),l=n%2==0?"sos-table-even":"sos-table-odd"
t+='<tr class="'+l+'">',t+='<td class="sos-table">'+r.observedPropertyTitle+"</td>",t+='<td class="sos-table">'+s.formatter(r.time)+"</td>",t+='<td class="sos-table">'+o.formatter(r.result.value,o.sciLimit,o.digits)+" "+r.uomTitle+"</td>",t+="</tr>"}i+='<table class="sos-table sos-embedded-table">',i+='<caption class="sos-table">'+this.config.latestObservationsPopup.caption+"</caption>",i+='<thead class="sos-table">',i+='<tr class="sos-table">'
for(var c=0,a=this.config.latestObservationsPopup.columnHeadings.length;a>c;c++)i+='<th class="sos-table">'+this.config.latestObservationsPopup.columnHeadings[c]+"</th>"
i+="</tr>",i+="</thead>",i+="<tfoot/>",i+="<tbody>",i+=t,i+="</tbody>",i+="</table>"}return i}})),void 0===SOS.Menu&&(SOS.Menu=OpenLayers.Class(SOS.Ui,{url:null,sos:null,config:null,CLASS_NAME:"SOS.Menu",initialize:function(e){this.url=null,this.sos=null,this.config={menu:{object:null,id:"sosMenu",entries:[],step:0,options:{tabs:{offerings:{active:!0,label:"Offerings",prompt:"Please select a Feature Of Interest from the Map"},observedProperties:{active:!0,label:"Observed Properties",prompt:"Please select an Offering"},controls:{active:!0,label:"Controls",prompt:"Please select an Observed Property"}},listBoxes:{multiple:!1,size:5,useSelectBox:!1},datePickers:{dateFormat:"yy-mm-dd",autoSize:!0,changeYear:!0,changeMonth:!0,onSelect:function(){jQuery(this).trigger("change")}},createNewItem:!1,promptForSelection:!0,plotTableControlsSection:{active:!0,sectionLabel:"Plot / Table",dateLabel:"Date Range",addToLabel:"Add To Existing",downloadData:{active:!0,icon:"ui-icon-disk",label:"Download Data",prompt:"Format the data for download",errorMessage:"No data selected.  You must plot/tabulate the data before you can download them.",commentCharacterLabel:"Comment Character",commentCharacters:["#","//","--","%",";"],columnSeparatorLabel:"Column Separator",columnSeparators:[","," ","|"," "],rowSeparatorLabel:"Row Separator",rowSeparators:["\n","\r\n","\r",";"]}},searchOfferings:{active:!0,label:"Search",prompt:""},listAllOfferings:{active:!0,label:"List all Offerings",prompt:"or alternatively"}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}}},jQuery.extend(!0,this,e)},destroy:function(){},setMenuOptions:function(e){jQuery.extend(!0,this.config.menu.options,e)},setInitialViewBlank:function(){this.config.menu.step=-1},display:function(e){arguments.length>0&&jQuery.extend(!0,this,e),this.haveValidCapabilitiesObject()?this._display():this.getCapabilities(this._display)},_display:function(){this.constructMenu(),-1==this.config.menu.step?(this.config.menu.step=0,this.displayBlankMenu()):1==this.config.menu.step?(this.config.menu.step=2,this.displayObservedProperties()):2==this.config.menu.step?(this.config.menu.step=3,SOS.Utils.isValidObject(this.config.menu.options.tabs.controls)&&this.config.menu.options.tabs.controls.active&&this.displayControls()):(this.config.menu.step=1,this.displayOfferings()),SOS.Utils.isValidObject(this.config.menu.options.tabs.controls)&&this.config.menu.options.tabs.controls.active&&this.initControls()},displayBlankMenu:function(){this.initBlankMenu()},displayOfferings:function(){var e=jQuery("#"+this.config.menu.id+"OfferingsTab")
this.constructOfferingsEntries(),this.initMenu(e),this.setupOfferingsBehaviour(),this.constructOfferingsTabControls(),this.promptForSelection(e)},constructOfferingsEntries:function(e){var t=[],i=[],e=e||{filterOnFOI:!0}
this.config.menu.entries=[]
var s=this.getCurrentItem()
if(e.filterOnFOI&&SOS.Utils.isValidObject(s)&&SOS.Utils.isValidObject(s.foi)){var o=[]
o=o.concat(this.sos.getOfferingsForFeatureOfInterestId(s.foi.id))
for(var n=0,a=o.length;a>n;n++)t.push(o[n].id),i.push(o[n].name)}else t=this.sos.getOfferingIds(),i=this.sos.getOfferingNames()
for(var n=0,a=t.length;a>n;n++){var r={value:t[n],label:i[n]}
this.config.menu.entries.push(r)}},setupOfferingsBehaviour:function(){var e=(jQuery("#"+this.config.menu.id),jQuery("#"+this.config.menu.id+"OfferingsTab > .sos-menu-select-list"))
e.bind("change",{self:this},function(e){var t=e.data.self,i=[]
i=i.concat(jQuery(this).val())
for(var s=0,o=i.length;o>s;s++){var n={offering:{id:i[s]}}
t.config.menu.options.createNewItem?t.setNewItem(n):t.updateCurrentItem(n)}t.displayObservedProperties(),t.sos.events.triggerEvent("sosMenuOfferingChange")})},constructOfferingsTabControls:function(e){var t=jQuery("#"+this.config.menu.id+"OfferingsTab"),e=e||{},i=this.config.menu.options
i.searchOfferings.active&&(e.showPrompt&&t.append("<p/>",i.searchOfferings.prompt),t.append("<p/>",this.constructSearchOfferingsInput())),i.listAllOfferings.active&&(e.showPrompt&&t.append("<p/>",i.listAllOfferings.prompt),t.append("<p/>",this.constructListAllOfferingsLink()))},constructSearchOfferingsInput:function(){this.getCurrentItem()
this.constructOfferingsEntries({filterOnFOI:!1})
var e=this.config.menu.entries.slice(0),t=jQuery("<input/>",{"class":"sos-watermark sos-menu-search-box",value:this.config.menu.options.searchOfferings.label}).autocomplete({source:e})
return t.bind("focus",function(){var e=jQuery(this)
e.val(""),e.removeClass("sos-watermark")}),t.bind("blur",{self:this},function(e){var t=e.data.self,i=jQuery(this)
i.val(t.config.menu.options.searchOfferings.label),i.addClass("sos-watermark")}),t.bind("autocompleteselect",{self:this},function(e,t){var i=e.data.self
if(SOS.Utils.isValidObject(t)&&SOS.Utils.isValidObject(t.item)){var s=jQuery("#"+i.config.menu.id+"OfferingsTab")
i.config.menu.selected=[],i.config.menu.entries=[],i.config.menu.entries.push(t.item),i.initMenu(s),i.setupOfferingsBehaviour(),i.constructOfferingsTabControls(),i.promptForSelection(s)}return!1}),t},constructListAllOfferingsLink:function(){var e=jQuery("<a/>",{text:this.config.menu.options.listAllOfferings.label}).button()
return e.bind("click",{self:this},function(e){var t=e.data.self
t.config.menu.selected=[],t.displayOfferings()}),e},displayObservedProperties:function(){var e=jQuery("#"+this.config.menu.id+"ObservedPropertiesTab")
this.constructObservedPropertiesEntries(),this.initMenu(e),this.setupObservedPropertiesBehaviour(),this.promptForSelection(e)},constructObservedPropertiesEntries:function(){var e=[],t=[]
this.config.menu.entries=[]
var i=this.getCurrentItem()
if(SOS.Utils.isValidObject(i)&&SOS.Utils.isValidObject(i.offering)){var s=this.sos.getOffering(i.offering.id)
e=s.getObservedPropertyIds(),t=SOS.Utils.toTitleCase(SOS.Utils.toDisplayName(SOS.Utils.urnToName(s.getObservedPropertyNames())))
for(var o=0,n=e.length;n>o;o++){var a={value:e[o],label:t[o]}
this.config.menu.entries.push(a)}}},setupObservedPropertiesBehaviour:function(){var e=(jQuery("#"+this.config.menu.id),jQuery("#"+this.config.menu.id+"ObservedPropertiesTab > .sos-menu-select-list"))
e.bind("change",{self:this},function(e){var t=e.data.self,i=[]
i=i.concat(jQuery(this).val())
for(var s=0,o=i.length;o>s;s++){var n={observedProperty:i[s]}
t.updateCurrentItem(n)}t.sos.events.triggerEvent("sosMenuObservedPropertyChange")})},displayControls:function(){var e=jQuery("#"+this.config.menu.id+"ControlsTab")
this.initControls(),this.promptForSelection(e)},initControls:function(){this.constructControls(),this.setupControlsBehaviour()},constructControls:function(){var e=jQuery("#"+this.config.menu.id+"ControlsTab"),t=this.config.menu.options
if(e.html(""),t.plotTableControlsSection.active){e.append(jQuery("<span></span>",{"class":"sos-control-title",text:t.plotTableControlsSection.sectionLabel}))
var i=jQuery('<div class="sos-control-section sos-control-section-container"/>')
e.append(i),i.append(jQuery("<span></span>",{text:t.plotTableControlsSection.dateLabel}))
var s=jQuery('<input type="text" id="'+this.config.menu.id+'ControlsStartDatetime"/>')
s.datepicker(this.config.menu.options.datePickers),i.append("<br/>",s)
var o=jQuery('<input type="text" id="'+this.config.menu.id+'ControlsEndDatetime"/>')
o.datepicker(this.config.menu.options.datePickers),i.append("<br/>",o)
var n=jQuery('<input type="checkbox" id="'+this.config.menu.id+'ControlsAddToExisting"></input>'),a=jQuery("<span></span>",{text:t.plotTableControlsSection.addToLabel})
if(i.append("<br/>",n,a),t.plotTableControlsSection.downloadData.active){var r=jQuery("<span></span>",{id:this.config.menu.id+"ControlsDownloadData","class":"sos-menu-icon-button"}).button({icons:{primary:t.plotTableControlsSection.downloadData.icon}}),l=jQuery("<span></span>",{text:t.plotTableControlsSection.downloadData.label})
i.append("<br/>",r,l)}}},setupControlsBehaviour:function(){var e=jQuery("#"+this.config.menu.id+"ControlsStartDatetime"),t=jQuery("#"+this.config.menu.id+"ControlsEndDatetime"),i=jQuery("#"+this.config.menu.id+"ControlsAddToExisting"),s=jQuery("#"+this.config.menu.id+"ControlsDownloadData")
e.bind("change",{self:this,pos:"start"},this.datepickerChangeHandler),t.bind("change",{self:this,pos:"end"},this.datepickerChangeHandler),i.bind("change",{self:this},this.addToExistingChangeHandler),s.bind("click",{self:this},this.downloadDataClickHandler)},datepickerChangeHandler:function(e){var t=e.data.self,i=e.data.pos,s=jQuery(this).val(),o={time:{}},n=t.getFirstItem()
"start"==i?(o.time.startDatetime=s,SOS.Utils.isValidObject(n)&&SOS.Utils.isValidObject(n.time)&&(o.time.endDatetime=n.time.endDatetime)):"end"==i&&(o.time.endDatetime=s,SOS.Utils.isValidObject(n)&&SOS.Utils.isValidObject(n.time)&&(o.time.startDatetime=n.time.startDatetime)),t.updateCurrentItem(o),t.updateItemsTimeInterval(o),"start"==i?t.sos.events.triggerEvent("sosMenuStartDatetimeChange"):"end"==i&&t.sos.events.triggerEvent("sosMenuEndDatetimeChange")},addToExistingChangeHandler:function(e){var t=e.data.self,i=jQuery(this).is(":checked"),s={options:{addToExisting:i}}
t.updateCurrentItem(s),t.sos.events.triggerEvent("sosMenuAddToExistingChange")},downloadDataClickHandler:function(e){var t=e.data.self
t.sos.events.triggerEvent("sosMenuDownloadDataClick")},constructMenu:function(){var e=jQuery("#"+this.config.menu.id+"Container"),t=jQuery("#"+this.config.menu.id+"ControlsContainer"),i=jQuery("#"+this.config.menu.id),s=jQuery("#"+this.config.menu.id+"Controls")
e.length<1&&(e=jQuery('<div id="'+this.config.menu.id+'Container" class="sos-menu-container"/>'),jQuery("body").append(e)),t.length<1&&(t=jQuery('<div id="'+this.config.menu.id+'Container" class="sos-menu-controls-container"/>'),jQuery("body").append(t)),i.length<1&&(i=jQuery('<div id="'+this.config.menu.id+'" class="sos-menu"/>'),e.append(i)),s.length<1&&(s=jQuery('<div id="'+this.config.menu.id+'ControlsPanel" class="sos-menu-controls"/>'),t.append(s))
var o=this.constructMenuTabs()
o&&i.append(o),o=this.constructMenuControlsTabs(),o&&s.append(o),i.bind("accordionchange",{self:this},this.changeMenuTabHandler),s.bind("accordionchange",{self:this},this.changeMenuTabHandler)
var n={fillSpace:!0,heightStyle:"fill"}
this.config.menu.step>-1&&(n.active=this.config.menu.step),i.accordion(n),s.accordion(n),this.config.menu.object={menu:i,controls:s}},constructMenuTabs:function(){var e,t="",i=this.config.menu.options
return SOS.Utils.isValidObject(i.tabs.offerings)&&i.tabs.offerings.active&&(t+='<h3><a href="#">'+i.tabs.offerings.label+'</a></h3><div id="'+this.config.menu.id+'OfferingsTab"></div>'),SOS.Utils.isValidObject(i.tabs.observedProperties)&&i.tabs.observedProperties.active&&(t+='<h3><a href="#">'+i.tabs.observedProperties.label+'</a></h3><div id="'+this.config.menu.id+'ObservedPropertiesTab"></div>'),e=jQuery(t)},constructMenuControlsTabs:function(){var e,t="",i=this.config.menu.options
return SOS.Utils.isValidObject(i.tabs.controls)&&i.tabs.controls.active&&(t+='<h3><a href="#">'+i.tabs.controls.label+'</a></h3><div id="'+this.config.menu.id+'ControlsTab"></div>'),e=jQuery(t)},initMenu:function(e){var t=this.config.menu.options.listBoxes,i=jQuery('<select id="'+this.config.menu.id+'SelectList"'+(t.multiple?' multiple="multiple"':"")+(t.size?' size="'+t.size+'"':"")+' class="sos-menu-select-list"></select>'),s=[]
e.html(""),e.append(i)
for(var o=0,n=this.config.menu.entries.length;n>o;o++)s.push('<option value="'+this.config.menu.entries[o].value+'">'+this.config.menu.entries[o].label+"</option>")
i.html(s.join("")),t.useSelectBox&&"function"==typeof jQuery("body").selectBox&&jQuery(".sos-menu-select-list").selectBox()},initBlankMenu:function(){var e=this.config.menu.options
if(SOS.Utils.isValidObject(e.tabs.offerings)&&e.tabs.offerings.active){var t=jQuery("#"+this.config.menu.id+"OfferingsTab");(void 0===t.html()||""==jQuery.trim(t.html()))&&(t.html(e.tabs.offerings.prompt),this.constructOfferingsTabControls({showPrompt:!0}))}if(SOS.Utils.isValidObject(e.tabs.observedProperties)&&e.tabs.observedProperties.active){var t=jQuery("#"+this.config.menu.id+"ObservedPropertiesTab");(void 0===t.html()||""==jQuery.trim(t.html()))&&t.html(e.tabs.observedProperties.prompt)}if(SOS.Utils.isValidObject(e.tabs.controls)&&e.tabs.controls.active){var t=jQuery("#"+this.config.menu.id+"ControlsTab");(void 0===t.html()||""==jQuery.trim(t.html()))&&t.html(e.tabs.controls.prompt)}},changeMenuTabHandler:function(e,t){var i=e.data.self,s=i.config.menu.options
if(SOS.Utils.isValidObject(s.tabs.offerings)&&s.tabs.offerings.active&&t.newHeader.text()==s.tabs.offerings.label){var o=jQuery("#"+i.config.menu.id+"OfferingsTab");(void 0===o.html()||""==jQuery.trim(o.html()))&&(o.html(s.tabs.offerings.prompt),i.constructOfferingsTabControls({showPrompt:!0}))}if(SOS.Utils.isValidObject(s.tabs.observedProperties)&&s.tabs.observedProperties.active&&t.newHeader.text()==s.tabs.observedProperties.label){var o=jQuery("#"+i.config.menu.id+"ObservedPropertiesTab");(void 0===o.html()||""==jQuery.trim(o.html()))&&o.html(s.tabs.observedProperties.prompt)}if(SOS.Utils.isValidObject(s.tabs.controls)&&s.tabs.controls.active&&t.newHeader.text()==s.tabs.controls.label){var o=jQuery("#"+i.config.menu.id+"ControlsTab");(void 0===o.html()||""==jQuery.trim(o.html()))&&o.html(s.tabs.controls.prompt)}},promptForSelection:function(e){this.config.menu.options.promptForSelection&&e.prev('h3[role="tab"]').trigger("click")},setNewItem:function(e){return this.config.menu.selected=this.config.menu.selected||[],this.config.menu.selected.push({item:e}),this.config.menu.selected.length-1},getItem:function(e){var t
if(SOS.Utils.isValidObject(this.config.menu.selected)){var i=this.config.menu.selected.length||0
i>0&&(0>e&&(e=i+e),e>=0&&i>e&&(t=this.config.menu.selected[e].item))}return t},setItem:function(e,t){var i=0,s=-1
return SOS.Utils.isValidObject(this.config.menu.selected)&&(i=this.config.menu.selected.length),i>0&&(0>t&&(t=i+t),t>=0&&i>t&&(this.config.menu.selected[t].item=e,s=t)),s},getCurrentItem:function(){return this.getItem(-1)},setCurrentItem:function(e){var t=this.setItem(e,-1)
return 0>t&&(t=this.setNewItem(e)),t},updateCurrentItem:function(e){var t=this.getCurrentItem()
return SOS.Utils.isValidObject(t)?(jQuery.extend(!0,t,e),this.setCurrentItem(t)):this.setNewItem(e),t},getFirstItem:function(){return this.getItem(0)},updateItemsTimeInterval:function(e){if(SOS.Utils.isValidObject(e.time)&&SOS.Utils.isValidObject(this.config.menu.selected))for(var t=this.config.menu.selected.length,i=0;t>i;i++)SOS.Utils.isValidObject(this.config.menu.selected[i].item)&&(this.config.menu.selected[i].item.time=this.config.menu.selected[i].item.time||{},SOS.Utils.isValidObject(e.time.startDatetime)&&(this.config.menu.selected[i].item.time.startDatetime=e.time.startDatetime),SOS.Utils.isValidObject(e.time.endDatetime)&&(this.config.menu.selected[i].item.time.endDatetime=e.time.endDatetime))}})),void 0===SOS.Info&&(SOS.Info=OpenLayers.Class(SOS.Ui,{url:null,sos:null,offering:null,observedProperty:null,config:null,CLASS_NAME:"SOS.Info",initialize:function(e){this.url=null,this.sos=null,this.offering=null,this.observedProperty=null,this.config={info:{object:null,id:"sosInfo","class":"sos-info-box",eventHandlers:[],content:null,contentTemplate:null,options:{show:!0,makeDraggable:!0,initialContent:{active:!0},contentSection:{active:!0,"class":"sos-info-box-content"},controlsSection:{active:!0,"class":"sos-info-box-control-section"},controlsSectionTitle:{active:!0,"class":"sos-info-box-control-section-title",label:""},showHideControl:{active:!0,"class":"sos-info-box-control ui-icon",icons:{show:"ui-icon-triangle-1-s",hide:"ui-icon-triangle-1-e"}},closeControl:{active:!0,"class":"sos-info-box-control-right ui-icon",icons:{close:"ui-icon-close"}}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}}},jQuery.extend(!0,this,e)},destroy:function(){},setInfoOptions:function(e){jQuery.extend(!0,this.config.info.options,e)},setContent:function(e){this.config.info.content=e},getContent:function(){return this.config.info.content},appendToContent:function(e){this.config.info.content?this.config.info.content+=e:this.config.info.content=e},setContentTemplate:function(e){this.config.info.contentTemplate=e},getContentTemplate:function(){return this.config.info.contentTemplate},appendToContentTemplate:function(e){this.config.info.contentTemplate?this.config.info.contentTemplate+=e:this.config.info.contentTemplate=e},initContentFromTemplate:function(){this.config.info.contentTemplate&&this.setContent(this.config.info.contentTemplate)},setContentFromTemplate:function(e,t){this.config.info.content&&this.setContent(this.config.info.content.replace(e,t))},setTitle:function(e){this.setInfoOptions({controlsSectionTitle:{label:e}})},setClass:function(e){this.config.info.class=e},addClass:function(e){this.config.info.class+=" "+e},addEventHandler:function(e){this.config.info.eventHandlers.push(e)},display:function(e){arguments.length>0&&jQuery.extend(!0,this.config.info.options,e),this.config.info.options.show&&(this.initInfoPanel(),this.displayInitialContent())},initInfoPanel:function(){var e=jQuery("#"+this.config.info.id)
e.length<1&&(e=jQuery("<div></div>",{id:this.config.info.id,"class":this.config.info.class}),jQuery("body").append(e)),this.config.info.object=e,this.config.info.options.makeDraggable&&this.config.info.object.draggable(),this.addContentSection(),this.addControlsSection(),this.addControlsSectionTitle(),this.addShowHideControl(),this.addCloseControl(),this.setupBehaviour()},displayInitialContent:function(){SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.initialContent.active&&this.displayContent()},displayContent:function(){if(SOS.Utils.isValidObject(this.config.info.object)){var e=this.config.info.object.children("."+this.config.info.options.contentSection.class)
e.html(this.config.info.content)}},updateContent:function(e){this.setContent(e),this.displayContent()},updateContentFromTemplate:function(e,t){this.config.info.content&&(this.setContent(this.config.info.content.replace(e,t)),this.displayContent())},addContentSection:function(){if(SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.contentSection.active){var e=jQuery("<div></div>",{"class":this.config.info.options.contentSection.class})
this.config.info.object.append(e)}},addControlsSection:function(){if(SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.controlsSection.active){var e=jQuery("<div></div>",{"class":this.config.info.options.controlsSection.class})
this.config.info.object.append(e)}},addControlsSectionTitle:function(){if(SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.controlsSectionTitle.active){var e=jQuery("<div></div>",{"class":this.config.info.options.controlsSectionTitle.class,html:this.config.info.options.controlsSectionTitle.label}),t=this.config.info.object.children("."+this.config.info.options.controlsSection.class)
t.append(e)}},addShowHideControl:function(){if(SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.showHideControl.active){var e=jQuery("<div></div>",{"class":this.config.info.options.showHideControl.class})
e.addClass(this.config.info.options.showHideControl.icons.show),e.bind("click",{self:this},this.showHideControlClickHandler)
var t=this.config.info.object.children("."+this.config.info.options.controlsSection.class)
t.append(e)}},showHideControlClickHandler:function(e){var t=jQuery(this),i=e.data.self.config.info.options.showHideControl.icons
t.hasClass(i.show)?(t.parent().siblings().hide(),t.removeClass(i.show),t.addClass(i.hide)):(t.parent().siblings().show(),t.removeClass(i.hide),t.addClass(i.show))},addCloseControl:function(){if(SOS.Utils.isValidObject(this.config.info.object)&&this.config.info.options.show&&this.config.info.options.closeControl.active){var e=jQuery("<div></div>",{"class":this.config.info.options.closeControl.class})
e.addClass(this.config.info.options.closeControl.icons.close),e.bind("click",{self:this},this.closeControlClickHandler)
var t=this.config.info.object.children("."+this.config.info.options.controlsSection.class)
t.append(e)}},closeControlClickHandler:function(e){var t=e.data.self.config.info.object
t&&t.remove()},setupBehaviour:function(){if(SOS.Utils.isValidObject(this.sos))for(var e=0,t=this.config.info.eventHandlers.length;t>e;e++){var i=this.config.info.eventHandlers[e]
SOS.Utils.isValidObject(i)&&SOS.Utils.isValidObject(i.event)&&SOS.Utils.isValidObject(i.callback)&&(i.scope=i.scope||this,this.sos.registerUserCallback(i))}}})),void 0===SOS.App&&(SOS.App=OpenLayers.Class(SOS.Ui,{url:null,sos:null,offering:null,offeringId:null,observedProperty:null,startDatetime:null,endDatetime:null,relativeTime:null,config:null,CLASS_NAME:"SOS.App",initialize:function(e){this.url=null,this.sos=null,this.offering=null,this.offeringId=null,this.observedProperty=null,this.startDatetime=null,this.endDatetime=null,this.relativeTime=null,this.config={app:{object:null,id:"sosApp",step:-1,components:{menu:null,map:null,plot:null,table:null,infoMetadata:null,infoHelp:null},options:{tabs:{map:{label:"Map"},plot:{label:"Plot"},table:{label:"Table"}},time:{useOfferingTimePeriod:!1,ms:26784e5},info:SOS.App.Resources.config.app.options.info}},overview:{object:null,id:"sosAppOverview",series:[],options:{show:!0,xaxis:{ticks:[],mode:"time"},yaxis:{ticks:[],autoscaleMargin:.1},selection:{mode:"x"},grid:{borderWidth:1},legend:{show:!1},series:{lines:{show:!0,lineWidth:1},shadowSize:0}}},format:{time:{formatter:SOS.Utils.jsTimestampToIso},value:{sciLimit:.1,digits:2,formatter:SOS.Ui.prototype.formatValueFancy}}},jQuery.extend(!0,this,e)},destroy:function(){},setAppOptions:function(e){jQuery.extend(!0,this.config.app.options,e)},setOverviewOptions:function(e){jQuery.extend(!0,this.config.overview.options,e)},display:function(e){arguments.length>0&&jQuery.extend(!0,this,e),this.haveValidCapabilitiesObject()?this._display():this.getCapabilities(this._display)},_display:function(){this.setupPlumbing(),this.displayApp()},setupPlumbing:function(){this.initComponents(),this.setupComponentsBehaviour()},initComponents:function(){var e=this.config.app.components,t={url:this.url,sos:this.sos}
e.menu=new SOS.Menu(t),e.map=new SOS.Map(t),e.plot=new SOS.Plot(t),e.table=new SOS.Table(t),e.infoMetadata=new SOS.Info(t),e.infoHelp=new SOS.Info(t)
for(var i in e)e[i].config.format=this.config.format
e.menu.config.menu.id=this.config.app.id+"Menu",e.map.config.map.id=this.config.app.id+"MapPanel",e.plot.config.plot.id=this.config.app.id+"PlotPanel",e.table.config.table.id=this.config.app.id+"TablePanel",e.infoMetadata.config.info.id=this.config.app.id+"InfoMetadataBox",e.infoHelp.config.info.id=this.config.app.id+"InfoHelpBox",e.menu.config.menu.step=this.config.app.step,e.table.setTableOptions({scrollable:!0}),this.config.overview.options.show&&(e.map.setOverviewOptions({show:!0}),e.plot.config.overview.id=this.config.app.id+"Overview",e.table.config.overview.id=this.config.app.id+"Overview"),e.infoMetadata.addClass("sos-info-metadata-box"),e.infoHelp.addClass("sos-info-help-box"),e.infoMetadata.setTitle(this.config.app.options.info.metadata.title),e.infoHelp.setTitle(this.config.app.options.info.help.title),e.infoMetadata.setContent(this.config.app.options.info.metadata.initialContent),e.infoHelp.setContent(this.config.app.options.info.help.initialContent)},setupComponentsBehaviour:function(){this.sos.registerUserCallback({event:"sosMapFeatureOfInterestSelect",scope:this,callback:this.sosMapFeatureOfInterestSelectHandler}),this.sos.registerUserCallback({event:"sosMenuOfferingChange",scope:this,callback:this.sosMenuChangeHandler}),this.sos.registerUserCallback({event:"sosMenuObservedPropertyChange",scope:this,callback:this.sosMenuChangeHandler}),this.sos.registerUserCallback({event:"sosMenuStartDatetimeChange",scope:this,callback:this.sosMenuChangeHandler}),this.sos.registerUserCallback({event:"sosMenuEndDatetimeChange",scope:this,callback:this.sosMenuChangeHandler}),this.sos.registerUserCallback({event:"sosMenuDownloadDataClick",scope:this,callback:this.sosMenuDownloadDataClickHandler}),this.setupInfoComponentsBehaviour()},setupInfoComponentsBehaviour:function(){var e=this.config.app.components,t=this
this.sos.registerUserCallback({event:"sosCapsAvailable",scope:e.infoMetadata,callback:function(){var e=this.config.format.time,t=this.sos.SOSCapabilities.serviceIdentification.title+"<p/>Data Availability<br/>Starts: "+e.formatter(this.sos.SOSCapabilities.operationsMetadata.GetObservation.parameters.eventTime.allowedValues.range.minValue)+"<br/>Ends: "+e.formatter(this.sos.SOSCapabilities.operationsMetadata.GetObservation.parameters.eventTime.allowedValues.range.maxValue)+"<br/>"
this.updateContent(t)}}),this.sos.registerUserCallback({event:"sosCapsAlreadyAvailable",scope:e.infoMetadata,callback:function(){var e=this.config.format.time,t=this.sos.SOSCapabilities.serviceIdentification.title+"<p/>Data Availability<br/>Starts: "+e.formatter(this.sos.SOSCapabilities.operationsMetadata.GetObservation.parameters.eventTime.allowedValues.range.minValue)+"<br/>Ends: "+e.formatter(this.sos.SOSCapabilities.operationsMetadata.GetObservation.parameters.eventTime.allowedValues.range.maxValue)+"<br/>"
this.updateContent(t)}}),e.infoMetadata.haveValidCapabilitiesObject()&&this.sos.events.triggerEvent("sosCapsAlreadyAvailable"),this.sos.registerUserCallback({event:"sosMenuOfferingChange",scope:e.infoMetadata,callback:function(){var t=this.config.format.time,i=e.menu.getCurrentItem()
if(i){var s=this.sos.getOffering(i.offering.id),o=s.name+"<p/>Data Availability<br/>Starts: "+t.formatter(s.time.timePeriod.beginPosition)+"<br/>Ends: "+t.formatter(s.time.timePeriod.endPosition)+"<br/>"
this.updateContent(o)}}}),this.sos.registerUserCallback({event:"sosMapFeatureOfInterestSelect",scope:e.infoMetadata,callback:function(){this.setContentTemplate("[%foi%] ([%lon%]&deg;, [%lat%]&deg;)<p/>Data Availability<br/>Starts: [%startDatetime%]<br/>Ends: [%endDatetime%]<br/>"),this.initContentFromTemplate()
var i=e.menu.getCurrentItem()
if(i){this.setContentFromTemplate(/\[%foi%\]/,i.foi.name)
var s=t.pointToLonLat(i.foi.geometry)
this.setContentFromTemplate(/\[%lon%\]/,parseFloat(s.x).toFixed(2)),this.setContentFromTemplate(/\[%lat%\]/,parseFloat(s.y).toFixed(2)),this.sos.getTemporalCoverageForFeatureOfInterestId(i.foi.id)}}}),this.sos.registerUserCallback({event:"sosTemporalCoverageAvailable",scope:e.infoMetadata,callback:function(){var e=this.config.format.time
this.setContentFromTemplate(/\[%startDatetime%\]/,e.formatter(this.sos.SOSTemporalCoverage.timePeriod.beginPosition)),this.setContentFromTemplate(/\[%endDatetime%\]/,e.formatter(this.sos.SOSTemporalCoverage.timePeriod.endPosition)),this.displayContent()}}),this.sos.registerUserCallback({event:"sosAppChangeAppTab",scope:e.infoHelp,callback:function(e){var i=e.data.componentName+"Content"
this.updateContent(t.config.app.options.info.help[i])}})},drawOverview:function(){var e=this.config.app.components,t=jQuery("#"+this.config.overview.id)
if(t.length<1){var i=jQuery("#"+this.config.app.id+"Container")
t=jQuery('<div id="sosAppOverview" class="sos-plot-overview"/>'),i.after(t)}this.config.overview.series=e.plot.config.plot.series.length>0?e.plot.config.plot.series:e.table.config.table.series,this.config.overview.object=jQuery.plot(t,this.config.overview.series,this.config.overview.options)},setupOverviewBehaviour:function(){var e=this.config.app.components,t=jQuery("#"+e.plot.config.plot.id),i=jQuery("#"+e.table.config.table.id),s=jQuery("#"+this.config.overview.id),o=this.config.overview
t.bind("plotselected",{self:this},function(e,t){var i=e.data.self.config.app.components,s=i.plot.config.plot.object.getOptions()
jQuery.extend(s.xaxes[0],{min:t.xaxis.from,max:t.xaxis.to}),i.plot.update(),i.plot.config.plot.object.clearSelection(t),i.table.subset(t.xaxis.from,t.xaxis.to),o.object.setSelection(t,!0)}),i.delegate("td","tableselecting",{self:this},function(e){var t=e.data.self.config.app.components
t.table.config.table.selecting=!0,t.table.highlightSelectedCellGroup(e.target)}),i.delegate("td","tableshiftclickselecting",{self:this},function(e){var t=e.data.self.config.app.components
t.table.highlightSelectedCellGroup(e.target)}),i.delegate("td","tableselected",{self:this},function(e,i){var s=e.data.self.config.app.components
if(delete s.table.config.table.selecting,i){var n=s.table.selectionToRanges(i)
if(i.items.length>1){s.table.subset(n.xaxis.from,n.xaxis.to),o.object.setSelection(n,!0),s.table.clearSelectionHighlighting()
var a=jQuery.Event("plotselected")
a.data={self:e.data.self},t.trigger(a,[n])}}}),s.bind("plotselected",{self:this},function(e,t){var i=e.data.self.config.app.components
i.plot.config.plot.object.setSelection(t)}),s.bind("plotunselected",{self:this},function(e){var t=e.data.self.config.app.components,i=t.plot.config.plot.object.getOptions()
jQuery.extend(i.xaxes[0],{min:null,max:null}),t.plot.update(),t.table.update()})},displayApp:function(){var e=jQuery("#"+this.config.app.id+"Container"),t=jQuery("#"+this.config.app.id+"MenuContainer"),i=jQuery("#"+this.config.app.id+"Menu"),s=jQuery("#"+this.config.app.id),o=jQuery("#"+this.config.app.id+"InfoRightContainer")
e.length<1&&(e=jQuery('<div id="'+this.config.app.id+'Container" class="sos-app-container"/>'),jQuery("body").append(e)),t.length<1&&(t=jQuery('<div id="'+this.config.app.id+'MenuContainer" class="sos-menu-container"/>'),e.append(t)),i.length<1&&(i=jQuery('<div id="'+this.config.app.id+'Menu" class="sos-menu"/>'),t.append(i)),s.length<1&&(s=jQuery('<div id="'+this.config.app.id+'" class="sos-app"/>'),e.append(s)),o.length<1&&(o=jQuery('<div id="'+this.config.app.id+'InfoRightContainer" class="sos-info-right-container"/>'),e.append(o)),this.config.app.components.menu.display()
this.constructAppTabs(s)
s.bind("tabscreate",{self:this},this.initAppHandler),s.tabs(),this.config.app.components.infoMetadata.display(),this.config.app.components.infoHelp.display()
var n=jQuery("#"+this.config.app.id+"InfoMetadataBox"),a=jQuery("#"+this.config.app.id+"InfoHelpBox")
o.append(n,a),this.config.app.object=s},constructAppTabs:function(e){var t,i,s,o,n,a=this.config.app.options
return t=jQuery("<ul/>"),e.append(t),SOS.Utils.isValidObject(a.tabs.map)&&(s=this.config.app.id+"MapPanel",i=jQuery('<div id="'+s+'" class="sos-map"/>'),e.append(i),o=jQuery('<a href="#'+s+'"><span class="sos-tab-header">'+a.tabs.map.label+"</span></a>"),o.bind("click",{self:this,componentName:"map"},this.changeAppTabHandler),n=jQuery('<li id="'+this.config.app.id+'MapTab"></li>'),n.append(o),t.append(n),this.initMap()),SOS.Utils.isValidObject(a.tabs.plot)&&(s=this.config.app.id+"PlotPanel",i=jQuery('<div id="'+s+'" class="sos-plot"/>'),e.append(i),o=jQuery('<a href="#'+s+'"><span class="sos-tab-header">'+a.tabs.plot.label+"</span></a>"),o.bind("click",{self:this,componentName:"plot"},this.changeAppTabHandler),n=jQuery('<li id="'+this.config.app.id+'PlotTab"></li>'),n.append(o),t.append(n)),SOS.Utils.isValidObject(a.tabs.table)&&(s=this.config.app.id+"TablePanel",i=jQuery('<div id="'+s+'" class="sos-table"/>'),e.append(i),o=jQuery('<a href="#'+s+'"><span class="sos-tab-header">'+a.tabs.table.label+"</span></a>"),o.bind("click",{self:this,componentName:"table"},this.changeAppTabHandler),n=jQuery('<li id="'+this.config.app.id+'TableTab"></li>'),n.append(o),t.append(n)),this.config.overview.options.show&&(s=this.config.app.id+"Overview",i=jQuery('<div id="'+s+'" class="sos-plot-overview"/>'),e.append(i)),t},initAppHandler:function(e){e.data.self},changeAppTabHandler:function(e){var t=e.data.self,i=(t.config.app.components,jQuery("#"+t.config.app.id+"Overview"))
i.length>0&&("map"==e.data.componentName?i.hide():i.show()),t.sos.events.triggerEvent("sosAppChangeAppTab",e)},initMap:function(){this.config.app.components.map.display()},sosMapFeatureOfInterestSelectHandler:function(){var e=this.config.app.components
e.menu.config.menu.selected=e.map.config.map.selected,e.menu.displayOfferings()},pointToLonLat:function(e){var t,i=this.config.app.components.map.config.map.object
return e&&(t=new OpenLayers.Geometry.Point(e.x,e.y).transform(i.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"))),t},sosMenuChangeHandler:function(){var e,t=this.config.app.components
t.menu.config.menu.selected&&(e=t.menu.getCurrentItem(),e.time=this.getObservationQueryTimeParameters(e)),this.haveRequiredObservationQueryParameters(e)&&(jQuery.extend(!0,this,{offeringId:e.offering.id,observedProperty:e.observedProperty,startDatetime:e.time.startDatetime,endDatetime:e.time.endDatetime}),SOS.Utils.isValidObject(e.options)&&(t.plot.config.mode.append=e.options.addToExisting,t.table.config.mode.append=e.options.addToExisting),this.getObservationData())},sosMenuDownloadDataClickHandler:function(){var e=this.config.app.components,t=this.config.app.components.menu.config.menu.options.plotTableControlsSection.downloadData.errorMessage
e.table.config.table.series.length>0?this.openDownloadDataDialog():alert(t)},openDownloadDataDialog:function(){var e=(this.config.app.components,this.config.app.components.menu.config.menu.options.plotTableControlsSection.downloadData),t=new SOS.Menu,i=jQuery("<div/>")
t.setMenuOptions({listBoxes:{size:1}})
var s=jQuery("<div></div>",{"class":"sos-download-dialog-control-row"}),o=jQuery("<div></div>",{text:e.prompt})
s.append(o),i.append(s)
for(var n=jQuery("<div></div>",{"class":"sos-download-dialog-control-row"}),a=jQuery("<div></div>",{text:e.commentCharacterLabel}),r=jQuery("<div></div>",{"class":"sos-download-dialog-select-list",id:this.config.app.id+"DownloadDataDialogCommentCharacterList"}),l=0,c=e.commentCharacters.length;c>l;l++){var f=SOS.Utils.nonPrintingCharacterToLabel(e.commentCharacters[l]),d={value:e.commentCharacters[l],label:f}
t.config.menu.entries.push(d)}t.initMenu(r),n.append(a,r),i.append(n),t.config.menu.entries=[]
for(var h=jQuery("<div></div>",{"class":"sos-download-dialog-control-row"}),p=jQuery("<div></div>",{text:e.columnSeparatorLabel}),u=jQuery("<div></div>",{"class":"sos-download-dialog-select-list",id:this.config.app.id+"DownloadDataDialogColumnSeparatorList"}),l=0,c=e.columnSeparators.length;c>l;l++){var f=SOS.Utils.nonPrintingCharacterToLabel(e.columnSeparators[l]),d={value:e.columnSeparators[l],label:f}
t.config.menu.entries.push(d)}t.initMenu(u),h.append(p,u),i.append(h),t.config.menu.entries=[]
for(var g=jQuery("<div></div>",{"class":"sos-download-dialog-control-row"}),b=jQuery("<div></div>",{text:e.rowSeparatorLabel}),v=jQuery("<div></div>",{"class":"sos-download-dialog-select-list",id:this.config.app.id+"DownloadDataDialogRowSeparatorList"}),l=0,c=e.rowSeparators.length;c>l;l++){var f=SOS.Utils.nonPrintingCharacterToLabel(e.rowSeparators[l]),d={value:e.rowSeparators[l],label:f}
t.config.menu.entries.push(d)}t.initMenu(v),g.append(b,v),i.append(g),t.config.menu.entries=[],jQuery("body").after(i)
var m=this,O=jQuery("#"+this.config.app.id+"DownloadDataDialogCommentCharacterList > .sos-menu-select-list"),S=jQuery("#"+this.config.app.id+"DownloadDataDialogColumnSeparatorList > .sos-menu-select-list"),y=jQuery("#"+this.config.app.id+"DownloadDataDialogRowSeparatorList > .sos-menu-select-list"),j=[{text:e.label,click:function(){var e={}
e.commentCharacter=O.val(),e.columnSeparator=S.val(),e.rowSeparator=y.val(),m.downloadTableSeriesData(e)}},{text:"Cancel",click:function(){jQuery(this).dialog().dialog("close")}}],w=i.dialog({position:["center","center"],buttons:j,title:e.label,width:400,zIndex:1010,stack:!1})
w.bind("dialogclose",function(){jQuery(this).remove(),jQuery(this).dialog().dialog("destroy")})},downloadTableSeriesData:function(e){var t=this.config.app.components,i={}
t.table.config.table.series.length>0&&(jQuery.extend(!0,e,t.table.config.table.options),t.table.generatePlainDataTable(i,t.table.config.table.series,e),SOS.Utils.isValidObject(i.tableText)&&(document.open("text/html"),document.write("<!DOCTYPE html>"+e.rowSeparator),document.write("<html><body><pre>"+e.rowSeparator),document.write(i.tableText),document.write("</pre></body></html>"+e.rowSeparator),document.close()))},isValidParameter:function(e){return SOS.Utils.isValidObject(e)&&""!==jQuery.trim(e)},haveRequiredObservationQueryParameters:function(e){return SOS.Utils.isValidObject(e)&&SOS.Utils.isValidObject(e.offering)&&SOS.Utils.isValidObject(e.time)&&this.isValidParameter(e.offering.id)&&this.isValidParameter(e.observedProperty)&&this.isValidParameter(e.time.startDatetime)&&this.isValidParameter(e.time.endDatetime)},getObservationQueryTimeParameters:function(e){var t={startDatetime:null,endDatetime:null}
if(SOS.Utils.isValidObject(e.time)&&this.isValidParameter(e.time.startDatetime)&&this.isValidParameter(e.time.endDatetime))t=e.time
else if(this.config.app.options.time.useOfferingTimePeriod){if(SOS.Utils.isValidObject(e.offering)){var i=this.sos.getOffering(e.offering.id)
t.startDatetime=i.time.timePeriod.beginPosition,t.endDatetime=i.time.timePeriod.endPosition}}else if(this.config.app.options.time.ms){var s={start:new Date,end:new Date}
s=SOS.Utils.adjustTimeInterval(s,-this.config.app.options.time.ms,0),t.startDatetime=s.start.toISOString(),t.endDatetime=s.end.toISOString()}return t},getObservationData:function(){if(this._getOffering(),this.haveValidOfferingObject()){if(SOS.Utils.isValidObject(this.observedProperty))if(SOS.Utils.isArray(this.observedProperty)){var e=this.config.app.components
e.plot.config.mode.append=!0,e.table.config.mode.append=!0
var t=this.observedProperty[e.plot.config.plot.series.length]
t&&this.offering.filterObservedProperties(t)}else this.offering.filterObservedProperties(this.observedProperty)
this.determineObservationQueryTimeParameters(),this.offering.registerUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData}),this.offering.getObservations(this.startDatetime,this.endDatetime)}},drawObservationData:function(){this.offering.unregisterUserCallback({event:"sosObsAvailable",scope:this,callback:this.drawObservationData})
var e=this.config.app.components
return this.storeObservationData(),SOS.Utils.isArray(this.observedProperty)&&e.plot.config.plot.series.length<this.observedProperty.length?(this.getObservationData(),e.plot.config.plot.series.length):(this.draw(),void 0)},storeObservationData:function(){var e=this.config.app.components
e.plot.offering=this.offering,e.table.offering=this.offering,e.plot.storeObservationData(),e.table.storeObservationData()},draw:function(){var e=this.config.app.components
e.plot.offering=this.offering,e.table.offering=this.offering,jQuery("#"+this.config.app.id+"PlotPanel").html(""),jQuery("#"+this.config.app.id+"PlotTab a").trigger("click"),e.plot.draw(),jQuery("#"+this.config.app.id+"TablePanel").html(""),e.table.draw(),this.config.overview.options.show&&(this.drawOverview(),e.table.config.overview.object=e.plot.config.overview.object=this.config.overview.object,this.setupOverviewBehaviour()),this.sos.events.triggerEvent("sosAppDrawObservationData")}}),SOS.App.Resources={config:{app:{options:{info:{metadata:{title:"Metadata",initialContent:"Welcome to SOS.App"},help:{title:"Help",initialContent:"Quick Start<ul><li>Select a Feature of Interest</li><li>Select an Offering from that Feature Of Interest</li><li>Select an Observed Property from that Offering</li></ul>The system will then plot/tabulate a rolling month's worth of data. Use the Controls to refine the query.",mapContent:"Map controls<ul><li>Click a point on the map to see available offerings</li><li>Zoom the map</li><ul><li>Shift+drag a region on the map to zoom in</li><li>Use the upper left '+' button to zoom in</li><li>Use the upper left '-' button to zoom out</li></ul><li>Drag to pan across the map</li><li>Click on the upper right '+' button to control available map layers</li><li>Click on the lower right '+' button to control the zoom region on an overview map</li></ul>",plotContent:"Plot controls<ul><li>Date Range</li><ul><li>Enter date as YYYY-MM-DD</li><li>Or pick from date selector</li></ul><li>Overplot further observed properties by checking Add To Existing</li><li>Subset the plot by dragging a selection across the plot (or across the lower overview plot); click anywhere on the overview plot to reset</li><li>Use the mouse scrollwheel to zoom in/out</li><li>Realign the plot vertically by dragging</li><li>Click on any two points on the plot to see summary statistics for data on that interval</li><li>Download the data via the Download Data button</li></ul>",tableContent:"Table controls<ul><li>Date Range</li><ul><li>Enter date as YYYY-MM-DD</li><li>Or pick from date selector</li></ul><li>Add further observed properties to the table by checking Add To Existing</li><li>Subset the table by dragging a selection down the table rows (or across the lower overview plot, or shift+click on any two rows on the table); click anywhere on the overview plot to reset</li><li>Click on any two rows on the table to see summary statistics for data on that interval</li><li>Download the data via the Download Data button</li></ul>"}}}}},CLASS_NAME:"SOS.App.Resources"}))
